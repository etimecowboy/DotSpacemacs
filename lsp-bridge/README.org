#+TITLE: lsp-bridge layer

* Table of Contents                                       :TOC_4_gh:noexport:
- [[#description][Description]]
- [[#lsp-bridge-tests-on-my-system][lsp-bridge tests on my system]]
  - [[#2022-08-31-wed][[2022-08-31 Wed]]]
    - [[#lsp-bridge-bridge-works-on-clean-emacs][lsp-bridge bridge works on clean emacs]]
    - [[#lsp-bridge-doesnt-jump-to-definition-together-with-lsp-layer-enabled][lsp-bridge doesn't jump to definition together with lsp layer enabled]]

* Description

This layer add config for the fastest lsp client - lsp-bridge.

lsp-bridge has not been supported by spacemacs, which includes the lsp-mode
package in the lsp layer as the default LSP client. Currently, lsp-bridge and
lsp-mode are not compatible.


* lsp-bridge tests on my system

- Ubuntu 22.04.01 LTS
- Emacs 28.1 with native-comp
- Spacemacs develop branch

** [2022-08-31 Wed]

TL,DR; The lsp-bridge package can only be used with a clean startup emacs, not
with lsp layer enabled. Therefore, this layer is not usable yet.

*** lsp-bridge bridge works on clean emacs

Start a clean emacs session with:


#+NAME: this_file
#+BEGIN_SRC emacs-lisp :exports none :results silent
(file-truename buffer-file-name)
#+END_SRC

Eval this to launch a fresh emacs with this file loaded.

#+BEGIN_SRC bash :var f=this_file
emacs -q $f
#+END_SRC

#+RESULTS:

Continue the test in the new emacs frame. Eval the minimum config with ~C-c C-c~
on the following block.

#+BEGIN_SRC emacs-lisp
;; minimum lsp-bridge config for test.

(setq package-use-dir "~/.emacs.d/elpa/28.1/develop")
(add-to-list 'load-path "~/.emacs.d/.cache/quelpa/build/lsp-bridge")
(add-to-list 'load-path "~/.emacs.d/elpa/28.1/develop/posframe-20220528.27")
(add-to-list 'load-path "~/.emacs.d/elpa/28.1/develop/yasnippet-20200604.246")
(add-to-list 'load-path "~/.emacs.d/elpa/28.1/develop/markdown-mode-20220829.225")

(require 'package)
(package-initialize)

(require 'posframe)
(require 'yasnippet)
(require 'lsp-bridge)
(require 'markdown-mode)

(yas-global-mode 1)
(global-lsp-bridge-mode)
#+END_SRC

#+RESULTS:

Open a python or C++ source file, and play around with it.

Example python code: [[file:~/src/algorithms/tests/test_dp.py]]

Screenshots:

- Documentation tooltip

#+ATTR_ORG: :width 800
[[file:img/2022-08-31_17-48-09.png]]

- Code completion

#+ATTR_ORG: :width 800
[[file:img/2022-08-31_17-52-08.png]]

*** lsp-bridge doesn't jump to definition together with lsp layer enabled

For example, for python development, my lsp backend was pyright.

- The lsp-mode functions works fine with all the build-in functions by the lsp layer.
- The lsp-bridge functions doesn't get me to a function definition.
